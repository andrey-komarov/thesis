\section{Вектора}

\AgdaHide{
\begin{code}%
\>\AgdaKeyword{module} \AgdaModule{VCSreport} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{OXIj.BrutalDepTypes}\<%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{With-⋀-and-⋙} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{open} \AgdaModule{Data-Vec}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{open} \AgdaModule{≡-Prop}\<%
\\
\>\<%
\end{code}
}

\subsection{Форма}

Построим систему контроля версий, в которой под контролем версий будут
находиться вектора длины \AgdaBound{n} элементов типа \AgdaBound{A}.
Патчи, соответственно, будут каким-то образом изменять эти вектора.
Определим для каждого патча его \emph{форму}: нечто, сообщающее,
\emph{что именно} будет менять патч в репозитории. В данном случае,
форма будет вектором булевых переменных такой же длины. Каждая
переменная отвечает за то, будет ли меняться соответствующий этой
позиции элемент:

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{Form} \AgdaSymbol{:} \AgdaDatatype{ℕ} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{Form} \AgdaSymbol{=} \AgdaDatatype{Vec} \AgdaDatatype{Bool} \<%
\end{code}

Определим для двух форм отношение \emph{совместности}. Две формы
называются \emph{совместными}, если два патча, обладающие этими
формами, никогда не будут \emph{конфликтовать}. Формально понятие
\emph{конфликтования} патчей будет введено позднее. На данный момент,
можно довериться интуитивному пониманию этого понятия.

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{data} \AgdaDatatype{\_∥\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Form} \AgdaBound{n} \AgdaSymbol{→} \AgdaFunction{Form} \AgdaBound{n} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{[]∥[]} \AgdaSymbol{:} \AgdaInductiveConstructor{[]} \AgdaDatatype{∥} \AgdaInductiveConstructor{[]}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊥∥⊥} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaDatatype{∥} \AgdaSymbol{(}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊤∥⊥} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{true} \AgdaInductiveConstructor{∷} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaDatatype{∥} \AgdaSymbol{(}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊥∥⊤} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaDatatype{∥} \AgdaSymbol{(}\AgdaInductiveConstructor{true} \AgdaInductiveConstructor{∷} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\end{code}

Здесь дано индуктивное опеределение совместности форм, которое гласит,
что пустые формы совместны, а непустые совместны, если первыми
элементами в них идут не два \AgdaInductiveConstructor{true}.

Например, формы 
\begin{tikzpicture}\matrix 
{\vecfe & \vecff & \vecfe & \vecfe & \vecff \\};
\end{tikzpicture} 
и 
\begin{tikzpicture}\matrix 
{\vecfe & \vecfe & \vecff & \vecff & \vecfe \\};
\end{tikzpicture} 
совместны, а 
\begin{tikzpicture}\matrix 
{\vecfe & \vecff & \vecfe & \vecfe & \vecff \\};
\end{tikzpicture} и 
\begin{tikzpicture}\matrix 
{\vecfe & \vecfe & \vecff & \vecff & \vecff \\};
\end{tikzpicture}~--- нет.
    
\subsection{Патч}

Теперь определим \emph{патч}, индексированный только что опеределённой
формой так, чтобы он менял только элементы, стоящие на местах, на
которых в которых в форме стоит \AgdaInductiveConstructor{true}:

\begin{figure}
  \centering
  \begin{subfigure}{0.45\textwidth}
    \centering
    \begin{tikzpicture}[anchor=center]
      \matrix [draw=red]
      {\vecf & \vect{a}{b} & \vecf & \vecf       & \vect{z}{y} \\};
    \end{tikzpicture}
    \caption{Патч}
    \label{fig:vec-patch-example-patch}
  \end{subfigure}
  \begin{subfigure}{0.45\textwidth}
    \centering
    \begin{tikzpicture}
      \matrix
      {\vecfe & \vecff & \vecfe & \vecfe & \vecff \\};
    \end{tikzpicture}
    \caption{Его форма}
    \label{fig:vec-patch-example-form}
  \end{subfigure}
  \caption{Патч для вектора}
  \label{fig:vec-patch-example}
\end{figure}
  
\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{data} \AgdaDatatype{Patch} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Form} \AgdaBound{n} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\end{code}

Патч, ничего не делающий с векторами нулевой длины.

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{O} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaInductiveConstructor{[]}\<%
\end{code}

Имея патч, оперирующий векторами длины \AgdaBound{n}, можно получить
патч, оперирующий векторами длины \AgdaBound{n} $+ 1$, не меняющий
элемент на первой позиции и соответственно имеющемуся патчу меняющий
остальные.

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊥∷} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaBound{f} \AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaSymbol{(}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{f}\AgdaSymbol{)}\<%
\end{code}

Или же, можно сделать патч, ожидающий увидеть на первой позиции
\AgdaBound{from}, заменяющий \AgdaBound{from} на \AgdaBound{to} и
применяющий к хвосту вектора имеющийся патч.

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⟨\_⇒\_⟩∷\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{from} \AgdaBound{to} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaBound{f} \AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaSymbol{(}\AgdaInductiveConstructor{true} \AgdaInductiveConstructor{∷} \AgdaBound{f}\AgdaSymbol{)}\<%
\end{code}

На рисунке~\ref{fig:vec-patch-example-patch} изображён патч для
векторов длины пять, заменяющий $a$ на второй позиции на $b$, $z$ на
пятой~--- на $y$. На рисунке~\ref{fig:vec-patch-example-form}
изображена его форма: вторая и пятая позиции меняются.

\AgdaHide{
\subsection{TODO ??? Вложенность патчей}

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{data} \AgdaDatatype{\_⊂\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Form} \AgdaBound{n} \AgdaSymbol{→} \AgdaFunction{Form} \AgdaBound{n} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{[]⊂[]} \AgdaSymbol{:} \AgdaInductiveConstructor{[]} \AgdaDatatype{⊂} \AgdaInductiveConstructor{[]}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊂⊤} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaInductiveConstructor{∷} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaDatatype{⊂} \AgdaSymbol{(}\AgdaInductiveConstructor{true} \AgdaInductiveConstructor{∷} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊥⊂⊥} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaDatatype{⊂} \AgdaSymbol{(}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\end{code}
}

Определим для патча и вектора отношение <<\emph{можно применить к}>>.
Будем говорить, что патч \AgdaBound{p} можно применить к вектору
\AgdaBound{v}, если на тех местах вектора, где в форме у \AgdaBound{p}
указано \AgdaInductiveConstructor{true}, стоит то, что ожидает увидеть
патч.

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{data} \AgdaDatatype{\_⊏\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaBound{f} \AgdaSymbol{→} \AgdaDatatype{Vec} \AgdaBound{A} \AgdaBound{n} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\end{code}

Пустой патч можно применить к пустому вектору.

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{[]⊏[]} \AgdaSymbol{:} \AgdaInductiveConstructor{O} \AgdaDatatype{⊏} \AgdaInductiveConstructor{[]}\<%
\end{code}

Патч, не меняющий первый элемент, применить можно.

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊥⊏} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{p} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{v} \AgdaSymbol{:} \AgdaDatatype{Vec} \AgdaBound{A} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{p} \AgdaDatatype{⊏} \AgdaBound{v} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p}\AgdaSymbol{)} \AgdaDatatype{⊏} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{∷} \AgdaBound{v}\AgdaSymbol{)}\<%
\end{code}

Патч, меняющий первый элемент можно применить только если первым
элементом вектора стоит ожидаемый патчем элемент.

\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊤⊏} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{p} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{v} \AgdaSymbol{:} \AgdaDatatype{Vec} \AgdaBound{A} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaBound{p} \AgdaDatatype{⊏} \AgdaBound{v} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{a} \AgdaInductiveConstructor{⇒} \AgdaBound{b} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p}\AgdaSymbol{)} \AgdaDatatype{⊏} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{∷} \AgdaBound{v}\AgdaSymbol{)}\<%
\end{code}

Напишем функцию применения патча \AgdaBound{p} к вектору
\AgdaBound{x}. Функция принимает на вход патч \AgdaBound{p}, вектор
\AgdaBound{x} и доказательство того, что \AgdaBound{p} можно применить
к \AgdaBound{x}.

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{patch} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Vec} \AgdaBound{A} \AgdaBound{n}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{p} \AgdaDatatype{⊏} \AgdaBound{x} \AgdaSymbol{→} \AgdaDatatype{Vec} \AgdaBound{A} \AgdaBound{n}\<%
\end{code}

Применение пустого патча к пустому вектору даёт пустой вектор.

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{patch} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{[]} \AgdaInductiveConstructor{[]⊏[]} \AgdaSymbol{=} \AgdaInductiveConstructor{[]}\<%
\end{code}

Применение патча, не меняющего первый элемент.

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{patch} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⊏} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{p-xs}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaFunction{patch} \AgdaBound{p} \AgdaBound{xs} \AgdaBound{p-xs}\<%
\end{code}

Применение патча, меняющего первый элемент.

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{patch} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaSymbol{.}\AgdaBound{f} \AgdaInductiveConstructor{⇒} \AgdaBound{t} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{f} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⊏} \AgdaSymbol{.}\AgdaBound{f} \AgdaSymbol{.}\AgdaBound{t} \AgdaBound{p-xs}\AgdaSymbol{)} \AgdaSymbol{=} \<[51]%
\>[51]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{t} \AgdaInductiveConstructor{∷} \AgdaFunction{patch} \AgdaBound{p} \AgdaBound{xs} \AgdaBound{p-xs}\<%
\end{code}

\subsection{Эквивалентность патчей}

Введём над патчами отношение \emph{эквивалентности}. Назовём патчи
эквивалентными, если:

\begin{itemize}
\item их можно применять к одним и тем же векторам;
\item при применении к одному и тому же вектору получается одно и то же.
\end{itemize}

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_⟶\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_⟶\_} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaBound{p₁} \AgdaBound{p₂} \AgdaSymbol{=} \AgdaSymbol{∀} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Vec} \AgdaBound{A} \AgdaBound{n}\AgdaSymbol{)} \<[34]%
\>[34]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁-x} \AgdaSymbol{:} \AgdaBound{p₁} \AgdaDatatype{⊏} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{Σ} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaDatatype{⊏} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(λ} \AgdaBound{p₂-x} \AgdaSymbol{→} \<[45]%
\>[45]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{patch} \AgdaBound{p₁} \AgdaBound{x} \AgdaBound{p₁-x} \AgdaDatatype{≡} \AgdaFunction{patch} \AgdaBound{p₂} \AgdaBound{x} \AgdaBound{p₂-x}\AgdaSymbol{))}\<%
\end{code}
      
\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_⟷\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{p₁} \AgdaFunction{⟷} \AgdaBound{p₂} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⟶} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaRecord{∧} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaFunction{⟶} \AgdaBound{p₁}\AgdaSymbol{)}\<%
\end{code}

Для того, чтобы отношение $\approx$ было отношением эквивалентности,
нужно, чтобы оно было:

\begin{itemize}
\item рефлексивным: $a \approx a$;
\item симметричным: $a \approx b \to b \approx a$;
\item транзитивным: $(a \approx b) \wedge (b \approx c) \to (a \approx c)$.
\end{itemize}

Все эти три свойства можно доказать.

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{module} \AgdaModule{⟷-equiv} \AgdaKeyword{where}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⟷-refl} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaBound{p} \AgdaFunction{⟷} \AgdaBound{p}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⟷-refl} \AgdaBound{p} \AgdaSymbol{=} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⟶-trans} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaBound{f₃} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}\{}\AgdaBound{p₃} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₃}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⟶} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaFunction{⟶} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⟶} \AgdaBound{p₃}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⟶-trans} \AgdaSymbol{\{p₁} \AgdaSymbol{=} \AgdaBound{p₁}\AgdaSymbol{\}\{}\AgdaBound{p₂}\AgdaSymbol{\}\{}\AgdaBound{p₃}\AgdaSymbol{\}} \AgdaBound{p₁⟶p₂} \AgdaBound{p₂⟶p₃} \AgdaBound{x} \AgdaBound{p₁⊏x} \<[49]%
\>[49]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaKeyword{with} \AgdaFunction{patch} \AgdaBound{p₁} \AgdaBound{x} \AgdaBound{p₁⊏x} \AgdaSymbol{|} \AgdaBound{p₁⟶p₂} \AgdaBound{x} \AgdaBound{p₁⊏x}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaFunction{patch} \AgdaBound{p₂} \AgdaBound{x} \AgdaBound{p₂⊏x}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaBound{p₂⊏x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaBound{p₂⟶p₃} \AgdaBound{x} \AgdaBound{p₂⊏x}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⟷-trans} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaBound{f₃} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}\{}\AgdaBound{p₃} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₃}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⟷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaFunction{⟷} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⟷} \AgdaBound{p₃}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⟷-trans} \AgdaSymbol{(}\AgdaBound{p₁⟶p₂} \AgdaInductiveConstructor{,} \AgdaBound{p₂⟶p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{p₂⟶p₃} \AgdaInductiveConstructor{,} \AgdaBound{p₃⟶p₂}\AgdaSymbol{)} \AgdaSymbol{=} \<[46]%
\>[46]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-trans} \AgdaBound{p₁⟶p₂} \AgdaBound{p₂⟶p₃}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-trans} \AgdaBound{p₃⟶p₂} \AgdaBound{p₂⟶p₁}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⟷-symm} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⟷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaFunction{⟷} \AgdaBound{p₁}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⟷-symm} \AgdaBound{p₁⟷p₂} \AgdaSymbol{=} \AgdaField{snd} \AgdaBound{p₁⟷p₂} \AgdaInductiveConstructor{,} \AgdaField{fst} \AgdaBound{p₁⟷p₂}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{open} \AgdaModule{⟷-equiv}\<%
\end{code}
}

TODO неправильное определение ⟷.

\subsection{Объединение неконфликтующих патчей}

Введём функцию, строяющую по двум совместным формам их объединение.
Эта функция просто будет считать поэлементное <<или>> двух форм.
Например, 
\begin{tikzpicture}\matrix 
{\vecfe & \vecff & \vecfe & \vecfe & \vecff \\};
\end{tikzpicture} \AgdaFunction{∧ₛ}
\begin{tikzpicture}\matrix 
{\vecfe & \vecfe & \vecff & \vecff & \vecfe \\};
\end{tikzpicture} \AgdaFunction{≡}
\begin{tikzpicture}\matrix 
{\vecfe & \vecff & \vecff & \vecff & \vecff \\};
\end{tikzpicture}

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₛ\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂} \AgdaSymbol{→} \AgdaFunction{Form} \AgdaBound{n}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₛ\_} \AgdaInductiveConstructor{[]} \AgdaInductiveConstructor{[]} \AgdaInductiveConstructor{[]∥[]} \AgdaSymbol{=} \AgdaInductiveConstructor{[]}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₛ\_} \AgdaSymbol{(}\AgdaSymbol{.}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaSymbol{.}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{ys}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaSymbol{(}\AgdaBound{xs} \AgdaFunction{∧ₛ} \AgdaBound{ys}\AgdaSymbol{)} \AgdaBound{p}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₛ\_} \AgdaSymbol{(}\AgdaSymbol{.}\AgdaInductiveConstructor{true} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaSymbol{.}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{ys}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{true} \AgdaInductiveConstructor{∷} \AgdaSymbol{(}\AgdaBound{xs} \AgdaFunction{∧ₛ} \AgdaBound{ys}\AgdaSymbol{)} \AgdaBound{p}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₛ\_} \AgdaSymbol{(}\AgdaSymbol{.}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaSymbol{.}\AgdaInductiveConstructor{true} \AgdaInductiveConstructor{∷} \AgdaBound{ys}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{true} \AgdaInductiveConstructor{∷} \AgdaSymbol{(}\AgdaBound{xs} \AgdaFunction{∧ₛ} \AgdaBound{ys}\AgdaSymbol{)} \AgdaBound{p}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{unite} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂} \AgdaSymbol{→} \AgdaFunction{Form} \AgdaBound{n}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{unite} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{f₁}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{f₂}\AgdaSymbol{\}} \AgdaBound{p} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{f₁} \AgdaFunction{∧ₛ} \AgdaBound{f₂}\AgdaSymbol{)} \AgdaBound{p}\<%
\end{code}

На основе этой функции определим функцию, которая по двум патчам с
совместными формами построит их объединение. Патч-объединение будет
изменять значение на позиции, если хотя бы в одном из объединяемых
патчей изменение на этой позиции было. Пример использования
\AgdaFunction{\_∧ₚ\_} изображён на
рисунке~\ref{fig:vec-merge-nonconflict}.

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₚ\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f₁∥f₂} \AgdaSymbol{:} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaSymbol{(}\AgdaFunction{unite} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \<[49]%
\>[49]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₚ\_} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{[]∥[]} \AgdaSymbol{=} \AgdaInductiveConstructor{O}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₚ\_} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{⊥∷} \AgdaSymbol{((}\AgdaBound{p₁} \AgdaFunction{∧ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{f₁∥f₂}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₚ\_} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{=} \<[49]%
\>[49]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{∧ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{f₁∥f₂}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_∧ₚ\_} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{=} \<[49]%
\>[49]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{∧ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{f₁∥f₂}\<%
\end{code}

\begin{figure}
  \centering
  \begin{tikzpicture}
    \matrix [draw=red] (lhs)
    {\vecf & \vect{a}{b} & \vecf & \vecf       & \vect{z}{b} \\};
  
    \node [vecpatch-op, right=0 of lhs] {$\wedge$};

    \matrix [draw=red, below=3mm of lhs] (rhs)
    {\vecf & \vecf       & \vecf & \vect{x}{x} & \vecf \\};

    \node [vecpatch-op, left=0 of rhs] {$\wedge$};
    \node [vecpatch-op, right=0 of rhs] {$=$};
  
    \matrix [draw=red, below=3mm of rhs] (res)
    {\vecf & \vect{a}{b} & \vecf & \vect{x}{x} & \vect{z}{b} \\};
  
    \node [vecpatch-op, left=0 of res] {$=$};
  \end{tikzpicture}

  \caption{Неконфликтующее объединение векторов}
  \label{fig:vec-merge-nonconflict}
\end{figure}

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⟶} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁} \AgdaFunction{⟶} \AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{\{p₁} \AgdaSymbol{=} \AgdaBound{p₁}\AgdaSymbol{\}\{}\AgdaBound{p₂}\AgdaSymbol{\}} \AgdaBound{p₁⟶p₂} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⊏} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{p₁⊏xs}\AgdaSymbol{)} \<[58]%
\>[58]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{patch} \AgdaBound{p₁} \AgdaBound{xs} \AgdaBound{p₁⊏xs} \AgdaSymbol{|} \AgdaBound{p₁⟶p₂} \AgdaBound{xs} \AgdaBound{p₁⊏xs}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaFunction{patch} \AgdaBound{p₂} \AgdaBound{xs} \AgdaBound{p₂⊏xs}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaBound{p₂⊏xs} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⊏} \AgdaBound{x} \AgdaBound{p₂⊏xs}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{⟶-prepend-⊤⊤} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{from} \AgdaBound{to} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⟶} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₁} \AgdaFunction{⟶} \AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₂}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{⟶-prepend-⊤⊤} \AgdaSymbol{\{p₁} \AgdaSymbol{=} \AgdaBound{p₁}\AgdaSymbol{\}\{}\AgdaBound{p₂}\AgdaSymbol{\}} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{to} \AgdaBound{p₁⟷p₂} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⊏} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{p₁⊏xs}\AgdaSymbol{)} \<[68]%
\>[68]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{patch} \AgdaBound{p₁} \AgdaBound{xs} \AgdaBound{p₁⊏xs} \AgdaSymbol{|} \AgdaBound{p₁⟷p₂} \AgdaBound{xs} \AgdaBound{p₁⊏xs} \<[44]%
\>[44]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaFunction{patch} \AgdaBound{p₂} \AgdaBound{xs} \AgdaBound{p₂⊏xs}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaBound{p₂⊏xs} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{⊤⊏} \AgdaBound{x} \AgdaBound{to} \AgdaBound{p₂⊏xs} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\<%
\end{code}
}

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{module} \AgdaModule{⟷-∧-lemmas} \AgdaKeyword{where}\<%
\end{code}
}

Коммутативность отношения совместности форм. Доказательство по
индукции по структуре доказательства \AgdaBound{f₁} \AgdaFunction{∥}
\AgdaBound{f₂}.

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∥-comm} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂} \AgdaSymbol{→} \AgdaBound{f₂} \AgdaDatatype{∥} \AgdaBound{f₁}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∥-comm} \AgdaInductiveConstructor{[]∥[]} \AgdaSymbol{=} \AgdaInductiveConstructor{[]∥[]}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∥-comm} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{⊥∥⊥} \AgdaSymbol{(}\AgdaFunction{∥-comm} \AgdaBound{f₁∥f₂}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∥-comm} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{⊥∥⊤} \AgdaSymbol{(}\AgdaFunction{∥-comm} \AgdaBound{f₁∥f₂}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∥-comm} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{⊤∥⊥} \AgdaSymbol{(}\AgdaFunction{∥-comm} \AgdaBound{f₁∥f₂}\AgdaSymbol{)}\<%
\end{code}
}

Если есть три попарно совместных формы, то объединение первых двух
совместно с третьей. Доказательство по индукции по доказательствам
попарной совместности.

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma-∥-unite} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaBound{f₃} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \<[45]%
\>[45]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f₁∥f₂} \AgdaSymbol{:} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{f₂} \AgdaDatatype{∥} \AgdaBound{f₃} \AgdaSymbol{→} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₃}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaFunction{unite} \AgdaBound{f₁∥f₂} \AgdaDatatype{∥} \AgdaBound{f₃}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma-∥-unite} \AgdaInductiveConstructor{[]∥[]} \AgdaInductiveConstructor{[]∥[]} \AgdaInductiveConstructor{[]∥[]} \AgdaSymbol{=} \AgdaInductiveConstructor{[]∥[]}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma-∥-unite} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{=} \<[56]%
\>[56]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{⊥∥⊥} \AgdaSymbol{(}\AgdaFunction{lemma-∥-unite} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma-∥-unite} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{=} \<[56]%
\>[56]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{⊥∥⊤} \AgdaSymbol{(}\AgdaFunction{lemma-∥-unite} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma-∥-unite} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{=} \<[56]%
\>[56]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{⊤∥⊥} \AgdaSymbol{(}\AgdaFunction{lemma-∥-unite} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma-∥-unite} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{=} \<[56]%
\>[56]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{⊤∥⊥} \AgdaSymbol{(}\AgdaFunction{lemma-∥-unite} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃}\AgdaSymbol{)}\<%
\end{code}
}

Коммутативность операции объединения неконфликтующих патчей. 
Получающиеся при обмене аргументов местами патчи эквивалентны.

\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-comm} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f₁∥f₂} \AgdaSymbol{:} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{p₁} \AgdaFunction{∧ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaFunction{⟷} \AgdaSymbol{((}\AgdaBound{p₂} \AgdaFunction{∧ₚ} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{∥-comm} \AgdaBound{f₁∥f₂}\AgdaSymbol{))}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-comm} \AgdaInductiveConstructor{[]∥[]} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O} \AgdaSymbol{=} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-comm} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-comm} \AgdaBound{f₁∥f₂} \AgdaBound{p₁} \AgdaBound{p₂}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-comm} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-comm} \AgdaBound{f₁∥f₂} \AgdaBound{p₁} \AgdaBound{p₂}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-comm} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{=} \<[53]%
\>[53]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-comm} \AgdaBound{f₁∥f₂} \AgdaBound{p₁} \AgdaBound{p₂}\<%
\end{code}
}

Транзитивность. Если три патча попарно не конфликтуют, то неважно, в 
каком порядке их применять. 

\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-trans} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaBound{f₃} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f₁∥f₂} \AgdaSymbol{:} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f₂∥f₃} \AgdaSymbol{:} \AgdaBound{f₂} \AgdaDatatype{∥} \AgdaBound{f₃}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f₁∥f₃} \AgdaSymbol{:} \AgdaBound{f₁} \AgdaDatatype{∥} \AgdaBound{f₃}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₃} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₃}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{p₁} \AgdaFunction{∧ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{f₁∥f₂} \AgdaFunction{∧ₚ} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma-∥-unite} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃}\AgdaSymbol{)}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{⟷} \<[10]%
\>[10]\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{∧ₚ} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaFunction{∧ₚ} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \<[33]%
\>[33]\<%
\\
\>[8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaFunction{∥-comm} \AgdaSymbol{(}\AgdaFunction{lemma-∥-unite} \AgdaBound{f₂∥f₃} \AgdaSymbol{(}\AgdaFunction{∥-comm} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{∥-comm} \AgdaBound{f₁∥f₂}\AgdaSymbol{)))}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-trans} \AgdaInductiveConstructor{[]∥[]} \AgdaInductiveConstructor{[]∥[]} \AgdaInductiveConstructor{[]∥[]} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O} \AgdaSymbol{=} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-trans} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaSymbol{=} \<[74]%
\>[74]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-trans} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃} \AgdaBound{p₁} \AgdaBound{p₂} \AgdaBound{p₃}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-trans} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaSymbol{=} \<[86]%
\>[86]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-trans} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃} \AgdaBound{p₁} \AgdaBound{p₂} \AgdaBound{p₃}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-trans} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaSymbol{=} \<[86]%
\>[86]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where} \<[76]%
\>[76]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-trans} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃} \AgdaBound{p₁} \AgdaBound{p₂} \AgdaBound{p₃}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-trans} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{()} \AgdaBound{p₁} \AgdaBound{p₂} \AgdaBound{p₃}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-trans} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{f₁∥f₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{f₂∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{f₁∥f₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaSymbol{=} \<[86]%
\>[86]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where} \<[76]%
\>[76]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-trans} \AgdaBound{f₁∥f₂} \AgdaBound{f₂∥f₃} \AgdaBound{f₁∥f₃} \AgdaBound{p₁} \AgdaBound{p₂} \AgdaBound{p₃}\<%
\end{code}
}


\subsection{Объединение конфликтующих патчей}

Введём для двух, возможно, конфликтующих, патчей отношение
\emph{возможности быть применёнными последовательно}. Разрешим второму
патчу менять только то, что уже поменял первый. 
    
\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{data} \AgdaDatatype{\_⋙?\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaBound{f₁} \AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaBound{f₂} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where} \<[71]%
\>[71]\<%
\end{code}

Пустые патчи можно применять последовательно. 

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{O⋙?O} \AgdaSymbol{:} \AgdaInductiveConstructor{O} \AgdaDatatype{⋙?} \AgdaInductiveConstructor{O}\<%
\end{code}

Оба патча не меняют первый элемент. 

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaDatatype{⋙?} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaDatatype{⋙?} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)}\<%
\end{code}

Только первый патч меняет первый элемент.

\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{from} \AgdaBound{to} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaDatatype{⋙?} \AgdaBound{p₂}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaDatatype{⋙?} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)}\<%
\end{code}

Оба патча меняют первый элемент.

\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{from} \AgdaBound{to} \AgdaBound{to₂} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaDatatype{⋙?} \AgdaBound{p₂}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaDatatype{⋙?} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{to} \AgdaInductiveConstructor{⇒} \AgdaBound{to₂} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₂}\AgdaSymbol{)}\<%
\end{code}


Как уже оговаривалось выше, при конфликтующем объединении патчей
считается, что второй патч меняет только то, что уже изменил первый.
Напишем функцию, которая последовательно применяет два патча,
обладающие таким свойством. Пример использования изображён на 
рисунке~\ref{fig:vec-merge-conflict}.

\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_⋙ₚ\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaDatatype{⋙?} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Patch} \AgdaBound{f₁}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_⋙ₚ\_} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O⋙?O} \AgdaSymbol{=} \AgdaInductiveConstructor{O}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_⋙ₚ\_} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{p₁-p₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{⊥∷} \AgdaSymbol{((}\AgdaBound{p₁} \AgdaFunction{⋙ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{p₁-p₂}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_⋙ₚ\_} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{a} \AgdaInductiveConstructor{⇒} \AgdaBound{b} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{a} \AgdaSymbol{.}\AgdaBound{b} \AgdaBound{p₁-p₂}\AgdaSymbol{)} \AgdaSymbol{=} \<[52]%
\>[52]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⟨} \AgdaBound{a} \AgdaInductiveConstructor{⇒} \AgdaBound{b} \AgdaInductiveConstructor{⟩∷} \AgdaSymbol{((}\AgdaBound{p₁} \AgdaFunction{⋙ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{p₁-p₂}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{\_⋙ₚ\_} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{a} \AgdaInductiveConstructor{⇒} \AgdaSymbol{.}\AgdaBound{b} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{b} \AgdaInductiveConstructor{⇒} \AgdaBound{c} \AgdaInductiveConstructor{⟩∷} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{a} \AgdaSymbol{.}\AgdaBound{b} \AgdaSymbol{.}\AgdaBound{c} \AgdaBound{p₁-p₂}\AgdaSymbol{)} \AgdaSymbol{=} \<[64]%
\>[64]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{⟨} \AgdaBound{a} \AgdaInductiveConstructor{⇒} \AgdaBound{c} \AgdaInductiveConstructor{⟩∷} \AgdaSymbol{((}\AgdaBound{p₁} \AgdaFunction{⋙ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{p₁-p₂}\AgdaSymbol{)}\<%
\end{code}

\begin{figure}
  \centering
  \begin{tikzpicture}
    \matrix [draw=red] (lhs)
    {\vecf & \vect{a}{b} & \vect{x}{y} & \vecf & \vect{z}{y} \\};

    \node [vecpatch-op, right=0 of lhs] {$\ggg$};

    \matrix [draw=red, below=3mm of lhs] (rhs)
    {\vecf & \vect{b}{c} & \vecf       & \vecf & \vect{y}{x} \\};

    \node [vecpatch-op, left=0 of rhs] {$\ggg$};
    \node [vecpatch-op, right=0 of rhs] {$=$};
          
    \matrix [draw=red, below=3mm of rhs] (res)
    {\vecf & \vect{a}{c} & \vect{x}{y} & \vecf & \vect{z}{x} \\};
          
    \node [vecpatch-op, left=0 of res] {$=$};
  \end{tikzpicture}
  \caption{Конфликтующее объединение векторов}
  \label{fig:vec-merge-conflict}
\end{figure}

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{module} \AgdaModule{⟷-⋙-lemmas} \AgdaKeyword{where}\<%
\end{code}
}
    
ТУТ МОДНАЯ КАРТИНКА, ОПИСЫВАЮЩАЯ ЭТО СВОЙСТВО

\begin{code}%
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-⋙-lem} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{fᵃ} \AgdaBound{fᵇ} \AgdaBound{fᶜ'} \AgdaBound{fᶜ''} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{c'} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{fᶜ'}\AgdaSymbol{)(}\AgdaBound{c''} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{fᶜ''}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{fᵃ}\AgdaSymbol{)(}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{fᵇ}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{c'∥c''} \AgdaSymbol{:} \AgdaBound{fᶜ'} \AgdaDatatype{∥} \AgdaBound{fᶜ''}\AgdaSymbol{)} \<[28]%
\>[28]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{a∥b} \AgdaSymbol{:} \AgdaBound{fᵃ} \AgdaDatatype{∥} \AgdaBound{fᵇ}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{a∧b>>>?c} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{∧ₚ} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{a∥b} \AgdaDatatype{⋙?} \AgdaSymbol{((}\AgdaBound{c'} \AgdaFunction{∧ₚ} \AgdaBound{c''}\AgdaSymbol{)} \AgdaBound{c'∥c''}\AgdaSymbol{))}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{a>>>?c'} \AgdaSymbol{:} \AgdaBound{a} \AgdaDatatype{⋙?} \AgdaBound{c'}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{b>>>?c''} \AgdaSymbol{:} \AgdaBound{b} \AgdaDatatype{⋙?} \AgdaBound{c''}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(((}\AgdaBound{a} \AgdaFunction{∧ₚ} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{a∥b}\AgdaSymbol{)} \AgdaFunction{⋙ₚ} \AgdaSymbol{((}\AgdaBound{c'} \AgdaFunction{∧ₚ} \AgdaBound{c''}\AgdaSymbol{)} \AgdaBound{c'∥c''}\AgdaSymbol{))} \AgdaBound{a∧b>>>?c} \<[58]%
\>[58]\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{⟷} \AgdaSymbol{((}\AgdaBound{a} \AgdaFunction{⋙ₚ} \AgdaBound{c'}\AgdaSymbol{)} \AgdaBound{a>>>?c'} \AgdaFunction{∧ₚ} \AgdaSymbol{(}\AgdaBound{b} \AgdaFunction{⋙ₚ} \AgdaBound{c''}\AgdaSymbol{)} \AgdaBound{b>>>?c''}\AgdaSymbol{)} \AgdaBound{a∥b}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-⋙-lem} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{O} \AgdaInductiveConstructor{[]∥[]} \AgdaInductiveConstructor{[]∥[]} \AgdaInductiveConstructor{O⋙?O} \AgdaInductiveConstructor{O⋙?O} \AgdaInductiveConstructor{O⋙?O} \AgdaSymbol{=} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-⋙-lem} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{c'∥c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{a∥b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{a∧b⋙?c}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{a⋙?c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{b⋙c''}\AgdaSymbol{)} \AgdaSymbol{=} \<[108]%
\>[108]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-⋙-lem} \AgdaBound{c'} \AgdaBound{c''} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c'∥c''} \AgdaBound{a∥b} \AgdaBound{a∧b⋙?c} \AgdaBound{a⋙?c'} \AgdaBound{b⋙c''}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-⋙-lem} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{c'∥c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{a∥b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{a∧b⋙?c}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{a⋙?c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{b⋙c''}\AgdaSymbol{)} \AgdaSymbol{=} \<[140]%
\>[140]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-⋙-lem} \AgdaBound{c'} \AgdaBound{c''} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c'∥c''} \AgdaBound{a∥b} \AgdaBound{a∧b⋙?c} \AgdaBound{a⋙?c'} \AgdaBound{b⋙c''}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-⋙-lem} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊥} \AgdaBound{c'∥c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{a∥b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{a∧b⋙?c}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{a⋙?c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{b⋙c''}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-⋙-lem} \AgdaBound{c'} \AgdaBound{c''} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c'∥c''} \AgdaBound{a∥b} \AgdaBound{a∧b⋙?c} \AgdaBound{a⋙?c'} \AgdaBound{b⋙c''}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-⋙-lem} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from₁} \AgdaInductiveConstructor{⇒} \AgdaSymbol{.}\AgdaBound{from} \AgdaInductiveConstructor{⟩∷} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{c'∥c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∥⊤} \AgdaBound{a∥b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{from₁} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{a∧b⋙?c}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{a⋙?c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{from₁} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{b⋙c''}\AgdaSymbol{)} \AgdaSymbol{=} \<[170]%
\>[170]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from₁} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from₁} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-⋙-lem} \AgdaBound{c'} \AgdaBound{c''} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c'∥c''} \AgdaBound{a∥b} \AgdaBound{a∧b⋙?c} \AgdaBound{a⋙?c'} \AgdaBound{b⋙c''}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∧-⋙-lem} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from} \AgdaInductiveConstructor{⇒} \AgdaBound{to} \AgdaInductiveConstructor{⟩∷} \AgdaBound{c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{from₁} \AgdaInductiveConstructor{⇒} \AgdaSymbol{.}\AgdaBound{from} \AgdaInductiveConstructor{⟩∷} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥∷} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{c'∥c''}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤∥⊥} \AgdaBound{a∥b}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{from₁} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{a∧b⋙?c}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{from₁} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{a⋙?c'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{b⋙c''}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from₁} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from₁} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{∧-⋙-lem} \AgdaBound{c'} \AgdaBound{c''} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c'∥c''} \AgdaBound{a∥b} \AgdaBound{a∧b⋙?c} \AgdaBound{a⋙?c'} \AgdaBound{b⋙c''}\<%
\end{code}
}

Ассоциативность \AgdaFunction{\_⋙\_}.

\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⋙-assoc} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{f₁} \AgdaBound{f₂} \AgdaBound{f₃} \AgdaSymbol{:} \AgdaFunction{Form} \AgdaBound{n}\AgdaSymbol{\}\{}\AgdaBound{p₁} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₁}\AgdaSymbol{\}\{}\AgdaBound{p₂} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₂}\AgdaSymbol{\}\{}\AgdaBound{p₃} \AgdaSymbol{:} \AgdaDatatype{Patch} \AgdaBound{f₃}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁>>?p₂} \AgdaSymbol{:} \AgdaBound{p₁} \AgdaDatatype{⋙?} \AgdaBound{p₂}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{[p₁>>ₚp₂]>>?p₃} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⋙ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{p₁>>?p₂} \AgdaDatatype{⋙?} \AgdaBound{p₃}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₂>>?p₃} \AgdaSymbol{:} \AgdaBound{p₂} \AgdaDatatype{⋙?} \AgdaBound{p₃}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p₁>>?[p₂>>ₚp₃]} \AgdaSymbol{:} \AgdaBound{p₁} \AgdaDatatype{⋙?} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaFunction{⋙ₚ} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaBound{p₂>>?p₃}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(((}\AgdaBound{p₁} \AgdaFunction{⋙ₚ} \AgdaBound{p₂}\AgdaSymbol{)} \AgdaBound{p₁>>?p₂}\AgdaSymbol{)} \AgdaFunction{⋙ₚ} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaBound{[p₁>>ₚp₂]>>?p₃}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{⟷}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{p₁} \AgdaFunction{⋙ₚ} \AgdaSymbol{(}\AgdaBound{p₂} \AgdaFunction{⋙ₚ} \AgdaBound{p₃}\AgdaSymbol{)} \AgdaBound{p₂>>?p₃}\AgdaSymbol{)} \AgdaBound{p₁>>?[p₂>>ₚp₃]}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⋙-assoc} \AgdaInductiveConstructor{O⋙?O} \AgdaInductiveConstructor{O⋙?O} \AgdaInductiveConstructor{O⋙?O} \AgdaInductiveConstructor{O⋙?O} \AgdaSymbol{=} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x₁} \AgdaSymbol{→} \AgdaBound{x₁} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⋙-assoc} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{p₁⋙?p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{[p₁⋙p₂]⋙?p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{p₂⋙?p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{p₁⋙?[p₂⋙p₃]}\AgdaSymbol{)} \AgdaSymbol{=} \<[80]%
\>[80]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊥⊥} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{))} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{⋙-assoc} \AgdaBound{p₁⋙?p₂} \AgdaBound{[p₁⋙p₂]⋙?p₃} \AgdaBound{p₂⋙?p₃} \AgdaBound{p₁⋙?[p₂⋙p₃]}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⋙-assoc} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaBound{from} \AgdaBound{to} \AgdaBound{p₁⋙?p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{[p₁⋙p₂]⋙?p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥⋙?⊥} \AgdaBound{p₂⋙?p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaBound{p₁⋙?[p₂⋙p₃]}\AgdaSymbol{)} \AgdaSymbol{=} \<[108]%
\>[108]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{⋙-assoc} \AgdaBound{p₁⋙?p₂} \AgdaBound{[p₁⋙p₂]⋙?p₃} \AgdaBound{p₂⋙?p₃} \AgdaBound{p₁⋙?[p₂⋙p₃]}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⋙-assoc} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaBound{from} \AgdaBound{to} \AgdaBound{to₂} \AgdaBound{p₁⋙?p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to₂} \AgdaBound{[p₁⋙p₂]⋙?p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊥} \AgdaSymbol{.}\AgdaBound{to} \AgdaSymbol{.}\AgdaBound{to₂} \AgdaBound{p₂⋙?p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaSymbol{.}\AgdaBound{to₂} \AgdaBound{p₁⋙?[p₂⋙p₃]}\AgdaSymbol{)} \AgdaSymbol{=} \<[127]%
\>[127]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to₂} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to₂} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{⋙-assoc} \AgdaBound{p₁⋙?p₂} \AgdaBound{[p₁⋙p₂]⋙?p₃} \AgdaBound{p₂⋙?p₃} \AgdaBound{p₁⋙?[p₂⋙p₃]}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{⋙-assoc} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaBound{from} \AgdaBound{to} \AgdaBound{to₂} \AgdaBound{p₁⋙?p₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to₂} \AgdaBound{to₃} \AgdaBound{[p₁⋙p₂]⋙?p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{to} \AgdaSymbol{.}\AgdaBound{to₂} \AgdaSymbol{.}\AgdaBound{to₃} \AgdaBound{p₂⋙?p₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{⊤⋙?⊤} \AgdaSymbol{.}\AgdaBound{from} \AgdaSymbol{.}\AgdaBound{to} \AgdaSymbol{.}\AgdaBound{to₃} \AgdaBound{p₁⋙?[p₂⋙p₃]}\AgdaSymbol{)} \AgdaSymbol{=} \<[136]%
\>[136]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to₃} \AgdaSymbol{(}\AgdaField{fst} \AgdaFunction{p}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaFunction{⟶-prepend-⊤⊤} \AgdaBound{from} \AgdaBound{to₃} \AgdaSymbol{(}\AgdaField{snd} \AgdaFunction{p}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{p} \AgdaSymbol{=} \AgdaFunction{⋙-assoc} \AgdaBound{p₁⋙?p₂} \AgdaBound{[p₁⋙p₂]⋙?p₃} \AgdaBound{p₂⋙?p₃} \AgdaBound{p₁⋙?[p₂⋙p₃]}\<%
\end{code}
}

